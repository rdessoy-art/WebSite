<!--
  EXAMPLE: Updated form submission code for Google Apps Script

  Replace the handleSubmit function in your index.html (around line 717-785)
  with this updated version.

  IMPORTANT: Update YOUR_SCRIPT_URL with your actual Google Apps Script web app URL!
-->

<script>
async function handleSubmit(event) {
    event.preventDefault();

    const form = event.target;
    const submitButton = form.querySelector('.submit-button');
    const formData = new FormData(form);

    // Remove any existing messages
    const existingMessage = form.querySelector('.form-message');
    if (existingMessage) {
        existingMessage.remove();
    }

    // Disable button and show loading state
    submitButton.disabled = true;
    submitButton.textContent = 'Submitting...';

    try {
        // Convert FormData to JSON object
        const jsonData = {};
        for (const [key, value] of formData.entries()) {
            jsonData[key] = value;
        }

        // Add additional data
        jsonData.timestamp = new Date().toISOString();
        jsonData.userAgent = navigator.userAgent;

        console.log('Submitting form data:', jsonData);

        // ⚠️ REPLACE THIS URL WITH YOUR GOOGLE APPS SCRIPT WEB APP URL!
        const response = await fetch('https://script.google.com/macros/s/YOUR_SCRIPT_URL_HERE/exec', {
            method: 'POST',
            mode: 'no-cors', // Important for Google Apps Script
            cache: 'no-cache',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(jsonData)
        });

        // Note: With 'no-cors' mode, we can't read the response
        // So we assume success if no error was thrown

        // Show success message
        const successMessage = document.createElement('div');
        successMessage.className = 'form-message success';
        successMessage.textContent = 'Thank you for joining the Harrison Dessoy Fan Club! You will receive a confirmation email shortly.';
        form.insertBefore(successMessage, form.firstChild);

        // Reset form
        form.reset();

        // Scroll to message
        successMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });

    } catch (error) {
        console.error('Form submission error:', error);

        // Show error message
        const errorMessage = document.createElement('div');
        errorMessage.className = 'form-message error';
        errorMessage.textContent = 'Oops! Something went wrong. Please try again or contact us directly at contact@harrisondessoy.com';
        form.insertBefore(errorMessage, form.firstChild);

        // Scroll to message
        errorMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
    } finally {
        // Re-enable button
        submitButton.disabled = false;
        submitButton.textContent = 'Join Now';
    }
}

// Attach form submission handler
const fanclubForm = document.getElementById('fanclubForm');
if (fanclubForm) {
    fanclubForm.addEventListener('submit', handleSubmit);
}
</script>

<!--
  Also remember to REMOVE the hidden access_key field from your form:

  DELETE THIS LINE:
  <input type="hidden" name="access_key" value="849b83c2-85b1-495c-8074-a020510f09b7">
-->
